<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" type="text/css" href="/css/post.css">
  <title>Single Post</title>
</head>

<body>
  <h1 class="title">Single Post</h1>
  <div class="post-details">
    <h2>Post Details</h2>
    <p>Post ID: <%= post.id %>
    </p>
    <p>Content: <%= post.content %>
    </p>
    <p>Author: <a href="/u/<%= post.author?.id %>">
        <%= post.author?.username %>
      </a></p>
    <p>Timestamp: <%= post.timestamp.toISOString() %>
    </p>
    <p>Visibility: <%= post.visibility %>
    </p>
  </div>

  <hr>

  <div class="add-comment">
    <h2>Add Comment</h2>
    <button class="addCommentButton" data-comment-id="<%= post.id %>">Add Comment</button>
  </div>

  <hr>

  <div id="commentsContainer" class="comments-container">
    <h2>Comments</h2>

    <% function displayComments(comments, depth) { %>
      <% comments?.forEach(function(comment) { %>
        <div class="comment">
          <h3>Comment ID: <a href="/p/<%= comment.id %>">
              <%= comment.id %>
            </a></h3>
          <p>Content: <%= comment.content %>
          </p>
          <p>Author: <a href="/u/<%= comment.author?.id %>">
              <%= comment.author?.username %>
            </a></p>
          <p>Timestamp: <%= comment.timestamp.toISOString() %>
          </p>
          <p>Visibility: <%= comment.visibility %>
          </p>
          <hr>
          <button class="addCommentButton" data-comment-id="<%= comment.id %>">Reply</button>
          <% if (comment.linkedPosts && comment.linkedPosts.length> 0) { %>
            <div class="nested-comments" style="margin-left: 20px;">
              <%= displayComments(comment.linkedPosts, depth + 1) %>
            </div>
            <% } %>
        </div>
        <% }); %>
          <% } %>

            <% if (post.linkedPosts?.length===0) { %>
              <p>No comments yet.</p>
              <% } else { %>
                <%= displayComments(post.linkedPosts, 0) %>
                  <% } %>
  </div>
  <script src="/script/post.js"></script>
</body>
</html>
